<div class="container mt-4">
  <h3>ðŸ›’ Mon Panier</h3>

  <!-- Loader -->
  <div *ngIf="loading" class="text-center p-4">
    <div class="spinner-border text-primary"></div>
    <p>Chargement du panier...</p>
  </div>

  <!-- Erreur -->
  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <!-- Panier vide -->
  <div *ngIf="!loading && panier?.items?.length === 0" class="alert alert-info">
    Votre panier est vide.
  </div>

  <!-- Table du panier -->
  <table class="table table-striped" *ngIf="panier?.items?.length">
    <thead class="table-light">
      <tr>
        <th>Produit</th>
        <th>Prix</th>
        <th>QuantitÃ©</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of panier.items">
        <td>{{ item.product?.name }}</td>
        <td>{{ item.product?.price | number:'1.0-0' }} CFA</td>
        <td>{{ item.quantity }}</td>
        <td>{{ (item.product?.price || 0) * item.quantity | number:'1.0-0' }} CFA</td>
        <td>
          <button class="btn btn-sm btn-danger" (click)="removeItem(item.product_id)">
            Retirer
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Footer panier -->
  <div *ngIf="panier?.items?.length" class="mt-3 d-flex justify-content-between align-items-center">
    <h4>Total: {{ panier.total | number:'1.0-0' }} CFA</h4>

    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-warning" (click)="clearPanier()">Vider le panier</button>

      <!-- Bouton pour ouvrir la sÃ©lection dâ€™adresse -->
      <button class="btn btn-outline-primary" (click)="adresseSelector.open()">
        Choisir une adresse
      </button>

      <!-- Bouton Commander -->
      <button class="btn btn-success" (click)="commanderPanier()" [disabled]="!selectedAdresse">
        Commander
      </button>
    </div>
  </div>
</div>

<!-- Popup sÃ©lection adresse -->
<app-adresse-selector (adresseSelected)="onAdresseChoisie($event)" #adresseSelector></app-adresse-selector>
